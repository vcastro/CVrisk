# Copilot Instructions for CVrisk

## Repository Overview

CVrisk is an R package for calculating various cardiovascular disease
risk scores. The package implements multiple risk assessment models
including: - Framingham 2008 10-year ASCVD risk (with lipid labs and BMI
variants) - ACC/AHA 2013 10-year ASCVD risk - MESA 2015 10-year ASCVD
risk (traditional risk factors and coronary artery calcium variants)

## Project Structure

- `R/` - Main R source code files implementing risk calculation
  functions
- `man/` - R documentation files (auto-generated by roxygen2)
- `tests/testthat/` - Test files using the testthat framework
- `data/` - Package data files
- `data-raw/` - Raw data and scripts for data preparation
- `docs/` - Package documentation website

## Development Practices

### R Package Conventions

This project follows standard R package development conventions: - Use
roxygen2 for function documentation (see `@param`, `@return`,
`@examples` tags) - Export public functions with `@export` - Follow R
package structure as defined in DESCRIPTION and NAMESPACE files - Use
semantic versioning (current version in DESCRIPTION file)

### Code Style

- Use descriptive variable names (e.g., `age`, `totchol`, `sbp`)
- Function names use snake_case (e.g., `ascvd_10y_accaha`,
  `compute_CVrisk`)
- Include comprehensive parameter validation in functions
- Return NA for invalid inputs or out-of-range values
- Use consistent parameter naming across functions:
  - `age` - patient age in years
  - `gender` - “male” or “female”
  - `race` - “white”, “aa” (African American), or “other”
  - `sbp` - systolic blood pressure in mm Hg
  - `totchol` - total cholesterol
  - `hdl` - HDL cholesterol
  - `bmi` - Body mass index in kg/m²
  - `bp_med` - blood pressure medication status (0/1 or FALSE/TRUE)
  - `smoker` - smoking status (0/1 or FALSE/TRUE)
  - `diabetes` - diabetes status (0/1 or FALSE/TRUE)

### Documentation Standards

- All exported functions must have complete roxygen2 documentation
- Include `@param` for each parameter with description
- Include `@return` describing the return value
- Include `@examples` with working code examples
- Document any data objects with `@format` and `@source`

### Testing Requirements

- Use testthat framework for all tests
- Test files should be named `test-<function_name>.R`
- Each test case should use descriptive names with `test_that()`
- Include tests for:
  - Valid input cases with expected outputs
  - Invalid inputs (should return NA)
  - Edge cases and boundary conditions
  - Different parameter combinations
- Run tests with
  [`devtools::test()`](https://devtools.r-lib.org/reference/test.html)
  or `testthat::test_check("CVrisk")`

## Build and Test Commands

### Setup Development Environment

``` r
# Install development dependencies
install.packages(c("devtools", "testthat", "roxygen2", "covr"))

# Load package for development
devtools::load_all()
```

### Building

``` r
# Build documentation
devtools::document()

# Build package
devtools::build()

# Check package (runs R CMD check)
devtools::check()
```

### Testing

``` r
# Run all tests
devtools::test()

# Run specific test file
testthat::test_file("tests/testthat/test-ascvd_10y_accaha.R")

# Test coverage
covr::package_coverage()
```

### Local Validation Before Committing

``` r
# Complete package check (recommended before commits)
devtools::check()
```

## CI/CD Workflows

The repository uses GitHub Actions with two main workflows: -
**R-CMD-check**: Runs R CMD check on multiple OS and R versions (Ubuntu,
Windows, macOS) - **test-coverage**: Measures test coverage and reports
to Codecov

Both workflows run on pushes and pull requests to main/master branches.

## Important Notes

- This package is published on CRAN, so changes must maintain backward
  compatibility
- Risk calculation functions use validated medical formulas - do not
  modify the mathematical formulas without proper medical references
- Invalid or out-of-range inputs should return NA (not throw errors)
- The package depends only on base R (with utils import), keep
  dependencies minimal
- Follow CRAN policies for package development
- Update NEWS.md for user-facing changes
- Update version number in DESCRIPTION for releases
